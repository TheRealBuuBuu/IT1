Relasjoner
==========
**Nå skal vi gå litt grundigere til verks når vi planlegger databasen til hurtigmatrestauranten.**

Tidligere har vi sett at vi kan sette opp en tabell for oppskrifter til hurtigmatrestauranten på denne måten:

| Menynavn          | Ingrediens         | Antall |
| ----------------- |------------------- | -----: |
| Superburger       | Hamburger 150      | 1      |
| Superburger       | Tomatskiver        | 2      |
| Superburger       | Sylteagurkskiver   | 1      |
| Superburger       | Burgerbrød         | 1      |
| Cheeseburger      | Hamburger 200 g    | 1      |
| Cheeseburger      | Cheddarostskiver   | 2      |
| Cheeseburger      | Burgerbrød         | 1      |
| Veggis            | Tomatskiver        | 4      |
| Veggis            | Jarlsbergostskiver | 1      |
| Veggis            | Burgerbrød         | 1      |

Dersom vi for eksempel vil ha oppskriften for Cheeseburger, kan vi spørre slik:

```SQL
SELECT * FROM Oppskrift WHERE Menynavn = 'CheeseBurger';
```

Dette ville fungert, men det kan lett oppstå problemer. Hva om vi for eksempel ved en feil la inn en rader i tabellen som er identiske med rader som er der fra før?

| Menynavn          | Ingrediens         | Antall |
| ----------------- |------------------- | -----: |
| Superburger       | Hamburger 150      | 1      |
| Superburger       | Tomatskiver        | 2      |
| Superburger       | Sylteagurkskiver   | 1      |
| Superburger       | Burgerbrød         | 1      |
| Cheeseburger      | Hamburger 200 g    | 1      |
| Cheeseburger      | Cheddarostskiver   | 2      |
| Cheeseburger      | Burgerbrød         | 1      |
| Veggis            | Tomatskiver        | 4      |
| Veggis            | Jarlsbergostskiver | 1      |
| Veggis            | Burgerbrød         | 1      |
| Cheeseburger      | Hamburger 200 g    | 1      |
| Cheeseburger      | Cheddarostskiver   | 2      |
| Cheeseburger      | Burgerbrød         | 1      |

Kjører vi spørringen på nytt, får vi nå dobbelt opp av alle ingrediensene for Cheeseburger. Vi må slette de radene som ble lagt inn ved en feil, men hvordan gjør vi det? Vi har ikke noe som unikt identifiserer hver rad i tabellen vår, og det er dermed ikke mulig å bare slette de tre radene som står nederst.

Vi må innføre en kolonne med verdier som vi er sikre på at alltid er unike. Vi lager kolonna `OppskriftID` som består av positive heltall (INTEGER), og sørger for at databasesystemet alltid sørger for å sette inn et unikt tall i denne kolonna for hver enkelt rad. Nå ser tabellen vår slik ut:

|OppskriftID | Menynavn          | Ingrediens         | Antall |
|----------: | ----------------- |------------------- | -----: |
|1           | Superburger       | Hamburger 150      | 1      |
|2           | Superburger       | Tomatskiver        | 2      |
|3           | Superburger       | Sylteagurkskiver   | 1      |
|4           | Superburger       | Burgerbrød         | 1      |
|5           | Cheeseburger      | Hamburger 200 g    | 1      |
|6           | Cheeseburger      | Cheddarostskiver   | 2      |
|7           | Cheeseburger      | Burgerbrød         | 1      |
|8           | Veggis            | Tomatskiver        | 4      |
|9           | Veggis            | Jarlsbergostskiver | 1      |
|10          | Veggis            | Burgerbrød         | 1      |

Den nye kolonna med ID-er gjør vi til en primærnøkkel for tabellen. Vi gjør tilsvarende for alle de andre tabellene i hurtigmatrestaurantdatabasen vår. Nå kan vi bruke ID-kolonnene vi har laget i alle tabellene som referanser når vi skal henvise fra en tabell til noe som ligger i en annen tabell.

|OppskriftID | MenyID | VareID | Antall |
|----------: | -----: |------: | -----: |
|1           | 1      | 1      | 1      |
|2           | 1      | 3      | 2      |
|3           | 1      | 4      | 1      |
|4           | 1      | 7      | 1      |
|5           | 2      | 2      | 1      |
|6           | 2      | 5      | 2      |
|7           | 2      | 7      | 1      |
|8           | 3      | 3      | 4      |
|9           | 3      | 6      | 1      |
|10          | 3      | 7      | 1      |


Tilsvarende ser nå menytabellen slik ut:

|MenyID | Menynavn          | Pris  |
|-----: | ----------------- |-----: |
|1      | Superburger       | 89    |
|2      | Cheeseburger      | 99    |
|3      | Veggis            | 49    |

Lagerbeholdningtabellen ser slik ut:

|VareID | Varenavn               | Beholdning |
|-----: | ---------------------- |----------: |
|1      | Hamburger 150 g        | 90         |
|2      | Hamburger 200 g        | 447        |
|3      | Tomatskiver            | 1232       |
|4      | Sylteagurkskiver       | 987        |
|5      | Cheddarostskiver       | 376        |
|6      | Jarlsbergostskiver     | 83         |
|7      | Burgerbrød             | 1995       | 

Slik setter vi opp tabellene våre i SQL:

```SQL
CREATE TABLE Lagerbeholdning (
  VareID INTEGER PRIMARY KEY,
  Varenavn CHAR(255),
  Beholdning INTEGER
);

CREATE TABLE Meny (
  MenyID INTEGER PRIMARY KEY,
  Menynavn CHAR(255),
  Pris FLOAT
);

CREATE TABLE Oppskrift (
  OppskriftID INTEGER PRIMARY KEY,
  MenyID INTEGER,
  VareID INTEGER,
  Antall INTEGER
);

CREATE TABLE Salg (
  SalgId INTEGER PRIMARY KEY,
  MenyID INTEGER,
  Antall INTEGER,
  Sum FLOAT,
  Dato TIMESTAMP
);
```